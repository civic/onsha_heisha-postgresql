I. チュートリアル
==================

第1章 さあ始めましょう
--------------------

### 1.1 インストール
ソースコードからビルドしてユーザー権限でインストールする。
[16章を参考](./16-installation.md)。

- vagrantのホームディレクトリで作業
- 手続き言語機能としてPL/Pythonをつかうための設定をする


- ユーザーディレクトリ上でデータベースクラスタの作成
- サーバープロセスの起動の起動

```
initdb -D pgdata
postgresql -D pgdata &
```

※本来であればpostgres専用のユーザーを用意し、サーバープロセスの実行ユーザー、データベースクラスは分離すべき

- ps でpostgresプロセスの確認
    - ps fx
- postgresプロセスの終了


### 1.3 データベースの作成

- pg_ctl start -D pgdata
- createdb mydb
- psql mydb
- サーバープロセスを落として実行しエラーになることを確認
- createdb のみでユーザー名と同名のデータベース作成
- dropdb mydb

### 1.4 データベースへのアクセス
- psqlを使って操作


第2章 SQL言語
--------------------

### 2.1 序文

チュートリアル用のSQL、C言語拡張などを作成。

- makefileの確認
    - .sourceから.sqlへ置換
    - カレントディレクトリへのパスを置換
- $HOME/postgresql-**/src/tutorialディレクトリでmake
- mydbにシングルステップモードで接続
- \iでbasics.sqlを読み込んで実行


### 2.2 概念

- テーブル: 行の集合
    - 行: 列の集合
        - 列：データ型を持つ

- PostgreSQLサーバーインスタンス
    - データベースクラスタ
        - データベース 
            - テーブル

### 2.3 新しいテーブルの作成

- 標準SQLにおける特殊な場合をサポートするケースを除き形名は構文内のキーワードではない

### 2.4 テーブルに行を挿入

- copyコマンドによるデータの挿入
- ファイルの読み込みはバックエンドプロセスで行われる(not クライアント)

### 2.5 テーブルへの問い合わせ

- DISTINCTでの実装でソートが含まれるが、標準SQLではDISTINCTがソートした結果を返すことを要求していない
    - DISTINCTした結果にもORDER BYをつけるべき

### 2.6 テーブル間を結合

- 練習: WHERE句を省略した場合のこの問い合わせの意味を考える
- 練習: 右外部結合、完全外部結合の意味を考える


### 2.7 集約関数

- max集約をWHERE句で使えない理由
- HAVING句ではmaxを使える理由
- LIKE演算子でパターンマッチ

### 2.8 更新
### 2.9 削除

第3章 高度な諸機能
--------------------

### 3.2 ビュー

- 実テーブルを隠蔽することができる
- 実テーブルを使えるほとんどの場所で使用可能

### 3.3 外部キー

- 参照整合性
- citiesに登録されていない cityは　weatherに使用できない
- weatherで使用されている cityは citiesから削除できない

### 3.4 トランザクション

- 複数の更新手続きが、すべて成功するかすべて失敗するか
- 原始的更新
- BEGIN / COMMIT
- SAVEPOINT / ROLLBACK TO

### 3.5 ウィンドウ関数

- 集計を特定の窓枠内で行う
- OVER内のORDER BYでウィンドウ内での行の処理順序を指定
- ウィンドウ演算が行われたあとにフィルタをかけるには副問い合わせにする
- WINDOW句でウィンドウ処理を分割

### 3.6 継承

- 属性を継承元のテーブルから引き継ぐ
- 制約や外部キーと統合されていないので万能ではない

